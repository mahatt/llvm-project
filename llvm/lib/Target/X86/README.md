# Backend
* PreISel
* Instruction Selection
  * FastISel
  * SelectionDAG
  * GlobalISel
* PreRA Instruction Scheduling
* Post Scheduling 
* Register Allocation
* Post RA 
* Post RA Instruction Scheduling
* Pre CodeEmission
* Code Emission

## Register Allocation
* Goal Convert pseudo-infinite virtual register into limited resource physical registers, when not possible move-to/from memory
* Input MIR
* Concepts
    + Spill
    + Spill slots
 
* Register Allocation Algorithms implemented in LLVM
   + Basic (linear scan)
   + Greedy
       + (Greedy Impl Blog)[https://blog.llvm.org/2011/09/greedy-register-allocation-in-llvm-30.html]
   + Fast
   + Partition boolean Quadratic Programming Programming solver
     
* Destroys SSA (not always) e.g.
    +  PHI Elimination Algorithm
    +  RA Eliminates Redundant copies generated by phi elimination
       
## What is Frame Index
* LLVM Codegeneration framework has concept of virtual frame throughout code generation
* Frame stores stack elements in function, numbered with indices
* Prologue allocates stack frame and Target uses virtual frame with target specific frame.
  Each Index is replaced by satck start + offset.
  https://github.com/mahatt/llvm-project/blob/bd0c5e4d04efcf1698a20b59df30563b65016d1e/llvm/lib/Target/X86/X86RegisterInfo.cpp#L890-L930

### Prologue 
* setup  stack frame
* callee-saved registers during the beginning of a function
* Add jump labels for exception handling frame used by eh handler.
  https://github.com/mahatt/llvm-project/blob/98815f7878c3240e27f516e331255532087f5fcb/llvm/lib/Target/X86/X86FrameLowering.cpp#L1448-L1456
  https://github.com/mahatt/llvm-project/blob/98815f7878c3240e27f516e331255532087f5fcb/llvm/lib/Target/X86/X86FrameLowering.cpp#L1533-L1550
*  Useful Data structures
  + MachineFrameInfo
  + X86MachineFunctionInfo 
  + EHPersonality
### Epilogue
* cleans up the stack frame prior to function return

### Inserting Prologu Epilog
* Code Driver
  https://github.com/mahatt/llvm-project/blob/48fa1e8fd095d8cd4615d88d6b3f143f80b6aeb4/llvm/lib/CodeGen/PrologEpilogInserter.cpp#L219-L240
  1. Calculate frame size
  2. Decide Basic Block where to add extra code for frame spill and restore
  3. Adjust DebugInfo for right stepping
  4. Spill Callee saved Reg in current function if needed
  5. Before Finalizing Frame , consult Target for final modification
  6. Calculate Real Offsets from Frame Indices
  7. If func is not Naked, emit Prolog Epilog
  8. Before Finalizing Offsets from Indices, consult target
  9. Replace Frame Indices possibly with direction forward and backward
  10. Check MAchineFrameInfo for result, conclude stack size and max stack size allowed.
      
